!function(){"use strict";var a=function(a){console.error("response error",a);var b,c=0,d=[];for(b=a[c];b;)d.push(b),c++,b=a[c];return d.join("")},b=function(a,b){return a-b[0].getBoundingClientRect().left},c=function(a,b){var c,d;if(a){if(a.indexOf)return a.indexOf(b);for(d=a.length,c=0;d>c;c++)if(a[c]===b)return c}return-1},d=function(a){for(var b;a&&!(b=a.data("amm-directive"));)a=a.parent();return a},e={rest:{media:{search:{url:"php/media.php?group=:group",params:{group:"@group"},method:"get",isArray:!0}},module:{search:{url:"php/media.php?group=:group",params:{group:"@group"},method:"get",isArray:!0}},mash:{search:{url:"php/media.php?group=mash",method:"get",isArray:!0},data:{url:"php/mash.php?id=:id",params:{id:"@id"},method:"get"},save:{url:"php/save.php?id=:id",params:{id:"@id"},method:"post"}},"import":{api:{url:"php/import_api.php",method:"post"},init:{url:"php/import_init.php",method:"post"},monitor:{url:"php/import_monitor.php",method:"post"}},"export":{init:{url:"php/export_init.php",method:"post"},monitor:{url:"php/export_monitor.php",method:"post"}}}},f=angular.module("angular.moviemasher",["ngResource","colorpicker.module","angularFileUpload"]);f.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0}]),f.constant("amm_resources",{});var g=function(a,b,c){a||(a=e);var d,f,g,h,i,j;for(h in e.rest)if(i=e.rest[h],j=a.rest[h],(i===j||!0===j)&&(j=i),j){g={};for(f in j)d={},i[f].isArray&&(d.isArray=!0),d.method=i[f].method,d.url=j[f].url,j[f].params&&(d.params=j[f].params),g[f]=d;b[h]=c(null,null,g)}};f.config(["$provide",function(a){var b=["$http"],c=MovieMasher,d=c.prototype;c.$inject=b,d.initialize=function(){this.registered=c.registered,this.supported=c.supported;var a,d=b.length;for(this.amm_injected={},a=0;d>a;a++)this.amm_injected[b[a]]=this.instance_arguments[a]},d.__player=null,Object.defineProperty(d,"player",{get:function(){return this.__player||(this.__player=c.player()),this.__player},set:function(a){this.__player=a}}),a.service("$amm",c)}]),f.directive("ammUi",["$amm","amm_resources","$resource",function(b,c,d){return{templateUrl:"views/ui.html",restrict:"AEC",controller:["$scope","$window","$interval","amm_resources",function(c,d,e,f){c.amm_resources=f;var g=-1;b.player.did=function(a){a&&g>=b.player.action_index&&(g=-2)},c.amm_export_displayed_status=function(){c.amm_export_completed=0},c.amm_export_completed=0,c.amm_import_completed=0,c.amm_export_status="",c.amm_import_status="";var h=function(b,d){var g=!1,h=0,j=0;h=e(function(){g||(g=!0,f["export"].monitor(b,function(b){if(g=!1,b.ok){if(b.completed>0&&b.completed<1)c.amm_export_completed=Math.max(.03,b.completed);else if(e.cancel(h),1===b.completed){var f=i(d);f&&(f.source=b.source),c.amm_export_completed=0}}else c.amm_export_status=b.error||a(b),c.amm_export_completed=-1,e.cancel(h)},function(a){console.warn("export.monitor",a),g=!1,j++,(a.status||j>3)&&(c.amm_export_status="error response from export monitor",c.amm_export_completed=-1,e.cancel(h))}))},5e3)};b.render=function(){var d=b.mash_id;f["export"]&&(c.amm_export_completed=.01,f["export"].init({id:d},function(b){b.ok?(c.amm_export_completed=.02,h(b,d)):(c.amm_export_status=b.error||a(b),c.amm_export_completed=-1)},function(a){console.error("export.init",a),c.amm_export_status="error response from export init",c.amm_export_completed=-1}))},b.can=function(a){var c=!1;switch(a){case"render":c=f["export"]&&b.player.duration&&!b.can("save");break;case"save":c=f.mash&&f.mash.save&&g!==b.player.action_index}return c},b.save=function(c){if(f.mash&&f.mash.save){var e=b.mash_id,h=b.player.action_index;f.mash.save({id:e},b.player.mash,function(f){if(f.ok){if(e===b.mash_id){g=h,j[e]&&delete j[e];var k=i(e);k&&(k.label=b.player.mash.label),c&&(b.mash_id=c,b.mash_id_change())}}else d.alert(f.error||a(f))})}};var i=function(a){var c,d=b.mashes.length;for(c=0;d>c;c++)if(b.mashes[c].id===a)return b.mashes[c];return!1},j={};c.amm_view_mash=function(){d.open(b.selected_mash.source)},b.mash_id_change=function(){var c=b.mash_id,e=b.player.mash.id;if(b.can("save"))b.mash_id=e,d.confirm('Save changes to "'+b.player.mash.label+'"?')&&b.save(c);else{var h={};if(c){var k=i(c);k&&(b.selected_mash=k,h.label=k.label,h.id=c,j[c]||f.mash&&f.mash.data({id:c},function(e){e.ok?c===b.mash_id&&(g=-1,b.player.mash=e.data):d.alert(e.error||a(e))}))}else h.label="New Untitled Mash",h.id=b.player.uuid(),j[h.id]=!0,b.mashes.push(h),b.mash_id=h.id,b.selected_mash=h;b.mash_id===h.id&&(g=-1,b.player.mash=h)}},b.mashes=[],b.mash_id=0,c.$amm=b,c.log_mash=function(){},c.amm_style_media_icon=function(a){var b,c={};if(a.icon)b=a.icon;else switch(a.type){case"image":b=a.url||a.source;break;case"audio":b=a.wave}return"audio"===a.type&&(c["background-size"]="100% 100%"),b&&(c["background-image"]="url("+b+")"),c}}],link:function(a,e,f){var h,i,j,k,l,m,n,o,p;b.MovieMasher.configure({mash:{"default":{quantize:10}}});for(m in f.$attr)switch(m){case"class":case"ammUi":break;default:if(o=f.$attr[m],n=f[m],l=o.split("-"),"amm"===l.shift())for(j=l.length,p||(p={}),h=p,i=0;j>i;i++)k=l[i],h[k]||(i===j-1?h[k]=n:h[k]={}),h=h[k]}g(p,c,d),c.module&&c.module.search&&(c.module.search({group:"font"},function(a){b.MovieMasher.register("font",a),c.mash&&c.mash.search({},function(a){a.length&&(angular.forEach(a,function(a){b.mashes.push(a)}),b.mash_id=b.mashes[0].id),b.mash_id_change()})}),c.module.search({group:"scaler"},function(a){b.MovieMasher.register("scaler",a)}),c.module.search({group:"merger"},function(a){b.MovieMasher.register("merger",a)}))}}}]),f.directive("ammPlayer",["$window","$amm",function(a,b){return{restrict:"AEC",replace:!1,template:'<canvas id="amm-canvas"></canvas>',link:function(c,d){if(a.CanvasRenderingContext2D){var e=d.find("canvas"),f=d[0].getBoundingClientRect();e.attr("width",f.width),e.attr("height",f.height),b.player.canvas_context=e[0].getContext("2d"),d.on("$destroy",function(){b.player.destroy()})}}}}]),f.directive("ammBrowser",["$timeout","$interval","$amm","amm_resources",function(b,c,d,e){return{restrict:"AEC",replace:!1,controller:["$scope","FileUploader",function(d,f){d.amm_import_displayed_status=function(){var a,b,c;for(c=i.length,b=0;c>b;b++)if(a=i[b],-1===a.completed){i.splice(b,1);break}j()};var g=d.uploader=new f({scope:d}),h={},i=[],j=function(){var a,b,c,e=0,f=0;for(c=i.length,b=0;c>b;b++){if(a=i[b],-1===a.completed)return d.amm_import_completed=-1,void(d.amm_import_status=a.status);f++,e+=a.completed}d.amm_import_completed=f?e/f:0,d.amm_import_status=""},k=function(a){var b,c,d=i.length;for(c=0;d>c;c++)if(b=i[c],b.upload===a)return b;return!1},l=function(b){var f=!1,g=0;b.interval_id=0,b.interval_id=c(function(){f||(f=!0,e["import"].monitor(b.monitor,function(e){if(f=!1,e.ok)if(e.completed>0&&e.completed<1)b.completed=.5+e.completed/2;else{if(c.cancel(b.interval_id),e.type){var g=e.type;"video"===g&&e.no_video&&"false"!==e.no_video&&(g="audio"),d.amm_browser_group_change(g)}else console.error("import_monitor_response did not include type key",e);var h=i.indexOf(b);h>-1?i.splice(h,1):console.error("could not delete upload",b)}else b.completed=-1,b.status=e.error||a(e),c.cancel(b.interval_id);j()},function(a){console.error("import.monitor",a),f=!1,g++,(a.status||g>3)&&(b.status="error getting response from monitor cgi",b.completed=-1,c.cancel(b.interval_id),j())}))},5e3)};e["import"]&&(g.onProgressItem=function(a,b){var c=k(a);c?(c.completed=Math.max(.03,b/200),j()):console.error("could not find upload for item",a)},g.onAfterAddingFile=function(b){var c={};c.file=b.file.name,c.size=b.file.size,c.type=b.file.type;var d={};d.uploading=!0,d.upload=b,d.completed=.01,d.name=c.name,i.unshift(d),j(),console.log("calling import.init",c);var f=function(a,b){a.completed=-1,a.status=b,j()};e["import"].init(c,function(c){if(console.log("import.init",c),c.ok){if(d.completed=.02,b.formData.push(c.data),c.headers)for(var e in c.headers)b.headers[e]=c.headers[e];d.api=c.api,b.url=c.endpoint,console.log(c.endpoint,c.data),b.upload()}else f(d,c.error||a(c))},function(){console.error("import.init",arguments),f(d,"error")})},g.onSuccessItem=function(c,d){var f;f=k(c),f?d.error?(f.status=d.error,f.completed=-1):f.api?(f.completed=.5,e["import"].api&&b(function(){e["import"].api(f.api,function(b){b.ok&&e["import"].monitor?(f.monitor=b.monitor,f.completed=.51,l(f)):(f.status=b.error||a(b),f.completed=-1),j()})},20)):console.error("upload had no api key?",f):console.error("could not find upload for item?",c),j()},g.onErrorItem=function(a){console.error("uploading file",arguments);var b=k(a);b?(b.status="problem uploading "+b.file,b.completed=-1,j()):console.error("could not find upload for item",a)}),e.module&&e.module.search?d.amm_browser_group="theme":d.amm_browser_group="video",d.amm_browser_group_change=function(a){if(a&&(d.amm_browser_group=a,h[d.amm_browser_group]&&delete h[d.amm_browser_group]),!h[d.amm_browser_group])switch(d.amm_browser_group){case"image":case"video":case"audio":e.media&&(h[d.amm_browser_group]=e.media.search({group:d.amm_browser_group}));break;default:e.module&&(h[d.amm_browser_group]=e.module.search({group:d.amm_browser_group}))}d.amm_media=h[d.amm_browser_group]},d.amm_browser_group_change()}]}}]),f.directive("ammDragMedia",["$amm","$parse",function(a,b){return{restrict:"AEC",templateUrl:"views/browser/clip.html",link:function(a,c,d){c.attr("draggable",!0),c.bind("dragstart",function(c){var e=d.ammDragMedia,f=b(e)(a),g={media:f,x:c.layerX,y:c.layerY},h="amm-"+f.type;c.dataTransfer.effectAllowed="link",c.dataTransfer.setData(h,angular.toJson(g))})}}}]),f.directive("ammInspector",["$amm",function(a){return{restrict:"AEC",replace:!1,link:function(b){b.amm_inspector_include=function(b){var c,d;if(b)if(b===a.player.mash)c="views/inspector/mash.html";else if(d=a.player.media(b))if(d.inspector)c=d.inspector;else switch(d.type){case"theme":case"transition":if(d.html){c=d.html;break}case"video":case"audio":case"image":c="views/inspector/"+d.type+".html";break;default:c=d.html}return c}}}}]),f.directive("ammInspectorEffects",["$amm",function(a){return{restrict:"AEC",controller:["$scope","$element","$amm",function(a,b){var e=this,f=function(a){var b,d,e,f=["amm-effects","amm-effect"];for(e=f.length,d=0;e>d;d++)if(b=f[d],-1<c(a,b))return b;return!1},g=function(a){return Array.prototype.indexOf.call(a[0].parentNode.childNodes,a[0])};e.__effects_drag_data=function(c,h){var i,j,k,l,m,n,o;if(c&&(j=f(c.dataTransfer.types))){for(m=!0,k={type:j,multiple:"amm-effects"===j,over_index:-1},h&&(k.data=c.dataTransfer.getData(j),k.data&&(k.data=angular.fromJson(k.data))),i={},o=angular.element(c.target);o&&(o=d(o))&&(n=o.data("amm-directive"),"ammInspectorEffects"!==n);)i[n]=o,o=o.parent();i.ammInspectorEffect&&(l=i.ammInspectorEffect,k.effect=l.data("amm-object"))}return(e.__over_effect_element!==l||e.__drop_ok!==m)&&a.$apply(function(){e.__over_effect_element!==l&&(e.__over_effect_element&&e.__over_effect_element.toggleClass("amm-drop-dragover",!1),e.__over_effect_element=l,e.__over_effect_element&&(k.over_index=g(l),e.__over_effect_element.toggleClass("amm-drop-dragover",!0))),e.__drop_ok!==m&&(e.__drop_ok=m,b.toggleClass("amm-drop-dragover",e.__drop_ok))}),m&&(c.preventDefault(),c.dataTransfer.dropEffect=k.multiple?"move":"link"),k}}],link:function(b,c,d,e){c.data("amm-directive","ammInspectorEffects"),c.bind("dragenter",e.__effects_drag_data),c.bind("dragover",e.__effects_drag_data),c.bind("dragleave",function(){e.__effects_drag_data()}),c.bind("drop",function(d){var f,g,h=e.__effects_drag_data(d,!0);h&&(f=a.player.selectedClipOrMash.effects,g=h.over_index,-1===g&&(g=f.length),b.$apply(function(){c.toggleClass("amm-drop-dragover",!1),h.multiple?a.player.move(a.player.selectedEffects,"effect",g):a.player.add(h.data.media,"effect",g)}),d.stopPropagation&&d.stopPropagation(),d.preventDefault())}),c.bind("dragend",function(c){"none"===c.dataTransfer.dropEffect&&b.$apply(function(){a.player.remove(a.player.selectedEffects,"effect")})})}}}]),f.directive("ammInspectorEffect",["$amm","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){d.data("amm-directive","ammInspectorEffect"),d.data("amm-object",c.effect);var f=b(e.ammInspectorEffect)(c);d.attr("draggable",!0),d.bind("dragstart",function(b){if(a.player.selected(f)){var c={effects:a.player.selectedEffects,x:b.layerX,y:b.layerY};b.dataTransfer.effectAllowed="moveCopy",b.dataTransfer.setData("amm-effects",angular.toJson(c))}else b.stopPropagation&&b.stopPropagation(),b.preventDefault()})}}}]),f.directive("ammTimeline",["$amm",function(){return{restrict:"AEC",controller:["$scope","$element","$amm",function(a,b,e){var f=this,g=[];f.scrollLeft=0,f.scrollTop=0,f.register_scroller=function(a){g.push(a)},a.amm_timeline_scroll=function(a){f.scrollLeft=a.target.scrollLeft,f.scrollTop=a.target.scrollTop;var b,c;for(c=g.length,b=0;c>b;b++)g[b](a)};var h=function(a){var b,d,e,f=["amm-clips-audio","amm-clips-overlays","amm-clips-video","amm-transition","amm-image","amm-frame","amm-theme","amm-video","amm-audio"];for(e=f.length,d=0;e>d;d++)if(b=f[d],-1<c(a,b))return b;return!1};f.pixels_from_frame=function(a,b,c,d){c||(c=e.player.mash.quantize);var g,h=0;return a&&(g=f.pixels_per_second(d),g&&(h=a/c*g,(b||"undefined"==typeof b)&&(h=Math[b||"ceil"](h)))),h},f.frame_from_pixels=function(a,b,c,d){c||(c=e.player.mash.quantize);var g,h=0;return a&&(g=f.pixels_per_second(d),g&&(h=a/g*c,(b||"undefined"==typeof b)&&(h=Math[b||"round"](h)))),h},f.pixels_per_second=function(b){var c,d=0,f=b?0:20;return c=e.player?e.player.duration:0,c&&(d=(a.amm_timeline_width()-f)/(c*(1.01-Math.max(.01,Math.min(1,a.amm_zoom))))),d},f.timeline_drag_data=function(c,e){var g,i,j,k,l,m,n;if(c&&(i=h(c.dataTransfer.types))){for(j={type:i,multiple:"amm-clips-"===i.substr(0,10)},e&&(j.data=c.dataTransfer.getData(i),j.data&&(j.data=angular.fromJson(j.data))),g={},n=angular.element(c.target);n&&(n=d(n))&&(m=n.data("amm-directive"),"ammTimelineTracks"!==m);)g[m]=n,n=n.parent();g.ammTimelineTrack&&(j.track=g.ammTimelineTrack.data("amm-object"),g.ammTimelineClip&&(j.clip=g.ammTimelineClip.data("amm-object")),j.multiple?(l="amm-clips-"+j.track.type===j.type,l=l||"video"===j.track.type&&"amm-clips-overlays"===j.type):(l="amm-"+j.track.type===j.type,l||"video"!==j.track.type||(l="amm-transition"===j.type?!j.track.index:"amm-audio"!==j.type)),l&&(k=g.ammTimelineTrack))}return(f.__over_track_element!==k||f.__drop_ok!==l)&&a.$apply(function(){f.__over_track_element!==k&&(f.__over_track_element&&f.__over_track_element.toggleClass("amm-drop-dragover",!1),f.__over_track_element=k,f.__over_track_element&&f.__over_track_element.toggleClass("amm-drop-dragover",!0)),f.__drop_ok!==l&&(f.__drop_ok=l,b.parent().toggleClass("amm-drop-dragover",f.__drop_ok))}),l&&(c.preventDefault(),c.dataTransfer.dropEffect=j.multiple?"move":"link"),j},f.track_for_clips=function(a){var b,c,d=a.length;for(c=0;d>c;c++){switch(e.player.media(a[c]).type){case"audio":b="audio";break;case"transition":b="video"}if(b)break}return b||(b="overlays"),b},a.amm_selected_class=function(a){return{"amm-selected":e.player.selected(a)}},a.amm_style_clip=function(a,b){var c={},d=e.player.media(a);return c.width=f.pixels_from_frame(a.frames,"floor")+"px",c["z-index"]=100*("transition"===d.type?10:1)+b.clips.indexOf(a),c.left=f.pixels_from_frame(a.frame,"floor")+"px",c.position="absolute",c},a.amm_timeline_view_width=function(){var b,c=e.player?e.player.duration:0;return b=c?c*f.pixels_per_second(!0):a.amm_timeline_width()},a.amm_zoom=0}]}}]),f.directive("ammTimelineTrackControls",["$amm",function(){return{restrict:"AEC",require:"^ammTimeline",link:function(a,b,c,d){d.register_scroller(function(){b[0].scrollTop=d.scrollTop}),a.amm_track_controls_width=function(){return b[0].getBoundingClientRect().width}}}}]),f.directive("ammTimelineRuler",["$amm","$document",function(a,b){return{restrict:"E",require:"^ammTimeline",link:function(c,d,e,f){var g=angular.element(b[0].body),h=0,i=function(b){c.$apply(function(){var c=b.pageX-h,d=f.frame_from_pixels(c,"round",a.player.fps,!0);a.player.frame=Math.max(0,Math.min(a.player.frames,d))})},j=function(a){i(a),g.unbind("mousemove"),g.unbind("mouseup"),g.unbind("mouseleave")};d.bind("mousedown",function(a){h=d[0].getBoundingClientRect().left+c.amm_track_controls_width()-f.scrollLeft,i(a),g.bind("mousemove",i),g.bind("mouseup",j),g.bind("mouseleave",j)})}}}]),f.directive("ammTimelineRule",["$amm",function(a){return{restrict:"E",require:"^ammTimeline",link:function(b,c,d,e){e.register_scroller(function(){b.$apply(function(){})}),b.amm_style_rule=function(){var d={};return d.left=e.pixels_from_frame(a.player.frame,"floor",a.player.fps,!0),d.left-=Math.floor(c[0].getBoundingClientRect().width/2),d.left+=b.amm_track_controls_width()-e.scrollLeft,d.left=String(d.left)+"px",d}}}}]),f.directive("ammTimelineTracks",["$amm","$window","$rootScope",function(a,c,d){return c.onresize=function(){d.$apply(function(){})},{restrict:"AEC",require:"^ammTimeline",link:function(c,d,e,f){c.amm_timeline_width=function(){return d[0].getBoundingClientRect().width},d.data("amm-directive","ammTimelineTracks"),e.$set("class","amm-timeline-tracks"),d.bind("scroll",c.amm_timeline_scroll),d.bind("dragenter",f.timeline_drag_data),d.bind("dragover",f.timeline_drag_data),d.bind("dragleave",function(){f.timeline_drag_data()}),d.bind("drop",function(e){var g,h,i,j,k=f.timeline_drag_data(e,!0);k&&(g=e.dataTransfer.dropEffect,f.timeline_drag_data(),j=a.player.mash[k.track.type],i=k.track.index,h="video"!==k.track.type||i?Math.max(0,f.frame_from_pixels(b(e.pageX,d)-k.data.x)):k.clip?k.track.clips.indexOf(k.clip):k.track.clips.length,c.$apply(function(){k.multiple?a.player.move(a.player.selectedClips,k.track.type,h,i):a.player.add(k.data.media,k.track.type,h,i)}),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault())})}}}]),f.directive("ammTimelineTrack",["$amm",function(a){return{restrict:"AEC",link:function(b,c){c.data("amm-directive","ammTimelineTrack"),c.data("amm-object",b.track),c.bind("mousedown",function(){b.$apply(function(){a.player.select(!1)})})}}}]),f.directive("ammTimelineClip",["$amm","$parse",function(a){return{restrict:"E",require:"^ammTimeline",templateUrl:"views/timeline/clip.html",replace:!0,link:function(b,c,d,e){c.data("amm-directive","ammTimelineClip"),c.data("amm-object",b.clip),c.bind("mousedown",function(c){b.$apply(function(){a.player.select(b.clip,c.shiftKey),c.stopPropagation&&c.stopPropagation()})}),c.bind("dragstart",function(c){if(a.player.selected(b.clip)){c.dataTransfer.effectAllowed="moveCopy";var d,f,g,h,i,j={},k={clips:a.player.selectedClips,x:c.layerX,y:c.layerY,media:[]};for(h=k.clips.length,d=h>1?c.dataTransfer.addElement:!1,g=0;h>g;g++)f=k.clips[g],i=a.player.media(f),j[i.id]||(j[i.id]=!0,k.media.push(i));c.dataTransfer.setData("amm-clips-"+e.track_for_clips(k.clips),angular.toJson(k))}else c.stopPropagation&&c.stopPropagation(),c.preventDefault()}),c.bind("dragend",function(c){"none"===c.dataTransfer.dropEffect&&b.$apply(function(){a.player.remove(a.player.selectedClips,b.track.type,b.track.index)})}),c.on("$destroy",function(){c.data("amm-object",null),c.data("amm-directive",null)})}}}]),f.directive("ammCanvasContainer",["$amm",function(a){return{restrict:"AEC",replace:!1,link:function(b,c){a.player.canvas_container=c[0],a.player.redraw(),c.on("$destroy",function(){a.player.canvas_container=null,a.player.redraw()})}}}]),f.directive("ammSynced",["$amm","$interval",function(a,b){return{restrict:"AEC",link:function(){b(function(){},100)}}}]),f.filter("secondsFromFrames",function(){return function(a,b){return a/b}}),f.filter("displaySeconds",function(){var a=function(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a};return function(b,c,d){var e,f,g,h="";return d||(d=b),e=3600,f=2,d>=e&&(b>=e?(h+=a(String(Math.floor(b/e)),f),g=!0,b%=e):h+="00:"),e=60,(g||d>=e)&&(g&&(h+=":"),b>=e?(h+=a(String(Math.floor(b/e)),f),g=!0,b%=e):h+="00:"),e=1,g||d>=e?(g&&(h+=":"),b>=e?(h+=a(String(Math.floor(b/e)),f),g=!0,b%=e):h+="00"):h+="00",c>1&&(10===c&&(f=1),h+=".",b?(b=1===f?Math.floor(10*b)/10:Math.floor(100*b)/100,b=Number(String(b).substr(2,2)),h+=a(String(b),f)):h+=a("0",f)),h}})}();